"""
Промпты для ML моделей.
"""
from typing import List

def get_orchestrator_prompt(requirements: List[str]) -> str:
    """
    Генерирует промпт для оркестратора.

    Args:
      requirements: Строковое представление всех требований к проекту

    Returns:
      str: Сформированный промпт 
    """

    return f"""
Ты - технический лид, задачей которого является распределение задач между своими подчинёнными без объяснения.
Твоя задача - проанализировать список требований и назначить каждому требованию наиболее подходящего для его анализа специалиста.

Доступные тебе специалисты:
1. Николас Хатэуэй - специализируется на информационной безопасности, аутентификации, защите данных и поиске уязвимостей. К нему отправляются задачи, связанные с шифрованием, SQL-инъекциями, XSS-атаками и любыми вопросами безопасности.
2. Чарли Эппс - превосходно оценивает количество используемых программой ресурсов и её алгоритмическую сложность. К нему отправляются задачи на анализ Big O, оптимизацию алгоритмов и оценку производительности.
3. Бертрам Гилфойл - помешан на чистоте кода, внимательно следит за соблюдением code style, желает видеть весь код задокументированным и покрытым тестами. К нему отправляются задачи на проверку форматирования, нейминга, docstring и unit-тестов.
4. Эллиот Алдерсон - параноидален, что заставляет его изучать все возможные краевые случаи. Всегда следит, чтобы логика программы в точности соответствовала техническому заданию. К нему отправляются задачи на валидацию входных данных, обработку ошибок и нестандартные сценарии.
5. Ричард Хендрикс - постоянно думает об архитектуре своих проектов. Безупречно знает паттерны проектирования. К нему отправляются задачи на анализ связности модулей, соответствие SOLID и выбор архитектурных решений.

Входные данные:
<requirements>
{'\n'.join(
  [f"""\t<req>
\t\t{req}
\t</req>""" for req in requirements.keys()]
)}
</requirements>

Формат вывода (JSON):
Ты должен возвращать валидный JSON объект, где ключом является порядковый номер требования, а значением - назначенный специалист.

Пример:
{{
  "1": "Николас Хатэуэй",
  "2": "Бертрам Гилфойл",
  "3": "Ричард Хендрикс"
}}

"""

def get_audit_prompt(requirements: str, project_structure: str, project_files: str) -> str:
    """
    Генерирует промпт для аудита кода.

    Args:
        project_structure: Строковое представление структуры проекта.
        project_files: Содержимое файлов проекта.

    Returns:
        str: Сформированный промпт.
    """

    return f"""
Ты — строгий Code Auditor и Senior Python Developer. Твоя задача — проверить код студенческого проекта и оценить его соответствие требованиям.

# РОЛЬ И ЦЕЛЬ:
Ты должен проанализировать предоставленный код и выставить оценки по критериям. Твои оценки должны быть объективными, а комментарии — конструктивными и ссылаться на конкретные части кода.

# ИНСТРУКЦИИ ПО АНАЛИЗУ:
1. Внимательно изучи структуру проекта (<project_structure>) и содержимое файлов (<project_files>).
2. Пройдись по каждому пункту из списка требований (<requirements>).
3. Для каждого требования:
    - Найди доказательства выполнения или невыполнения в коде.
    - Если требование подразумевает количественную оценку (например, "2.5 балла за каждый паттерн"), проведи расчет.
    - Сформулируй обоснование (justification), указывая конкретные файлы, классы, функции и, по возможности, номера строк.
    - Дай рекомендации по улучшению (suggestions), если оценка не максимальная.
    - Выстави оценку (score) от 0 до 10.

# ТРЕБОВАНИЯ К ВЫВОДУ (JSON):
- Твой ответ должен быть ИСКЛЮЧИТЕЛЬНО валидным JSON объектом.
- НЕ пиши никаких вступительных слов, не используй markdown-блоки (```json).
- Структура JSON должна строго соответствовать примеру ниже.

Пример JSON ответа:
{{
  "evaluations": [
    {{
      "requirement_id": 1,
      "requirement_text": "Использование паттернов проектирования...",
      "score": 5,
      "max_score": 10,
      "justification": "Обнаружен паттерн Singleton в файле src/db.py (класс Database). Паттерн Factory в src/utils.py реализован с ошибкой (нарушен принцип OCP).",
      "suggestions": "Рекомендуется исправить реализацию Factory, используя абстрактный базовый класс."
    }}
  ],
  "total_score": 5,
  "general_feedback": "Проект имеет хорошую структуру, но требует доработки в части архитектурных паттернов."
}}

# ВХОДНЫЕ ДАННЫЕ:

<requirements>
{requirements}
</requirements>

<project_structure>
{project_structure}
</project_structure>

<project_files>
{project_files}
</project_files>

Оцени соответствие проекта требованиям, основываясь ТОЛЬКО на коде выше.
"""
