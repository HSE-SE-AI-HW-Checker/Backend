# ML Server (LLaMA Local)

–õ–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∫–≤–∞–Ω—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö LLM –º–æ–¥–µ–ª–µ–π (LLaMA, Qwen, Mistral, DeepSeek) –Ω–∞ CPU –∏ GPU (Metal –Ω–∞ macOS).

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üöÄ **–õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ GGUF —Ñ–æ—Ä–º–∞—Ç–∞ —á–µ—Ä–µ–∑ `llama-cpp-python`.
- üì• **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞**: –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π —Å Hugging Face –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ.
- üçé **Apple Silicon**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Metal (MPS) –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –Ω–∞ Mac.
- üìù **Streaming**: –ü–æ—Ç–æ–∫–æ–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ (SSE).
- üåê **FastAPI**: REST API –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Backend.
- ‚öôÔ∏è **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: –ì–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ `config.yaml`.

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.10+
- macOS (Apple Silicon) –∏–ª–∏ Linux/Windows —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π CUDA (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- –ú–∏–Ω–∏–º—É–º 8GB RAM (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –º–æ–¥–µ–ª–∏)

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1.  **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é ML:**
    ```bash
    cd ML
    ```

2.  **–°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:**
    ```bash
    python -m venv venv
    source venv/bin/activate
    ```

3.  **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
    –î–ª—è macOS —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Metal:
    ```bash
    CMAKE_ARGS="-DLLAMA_METAL=on" pip install -r requirements.txt
    ```
    –î–ª—è Linux/Windows (CPU):
    ```bash
    pip install -r requirements.txt
    ```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Ñ–∞–π–ª–µ `config.yaml`. –í—ã –º–æ–∂–µ—Ç–µ –≤—ã–±—Ä–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—É—é –º–æ–¥–µ–ª—å –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.

–ü—Ä–∏–º–µ—Ä `config.yaml`:
```yaml
active_model: "qwen-2.5-coder-14b"

models:
  qwen-2.5-coder-14b:
    download:
      repo_id: "bartowski/Qwen2.5-Coder-14B-Instruct-GGUF"
      filename: "Qwen2.5-Coder-14B-Instruct-Q4_K_M.gguf"
      auto_download: true
    model:
      path: "./models/Qwen2.5-Coder-14B-Instruct-Q4_K_M.gguf"
      n_ctx: 16384
      n_gpu_layers: -1
```

## –ó–∞–ø—É—Å–∫

### API –°–µ—Ä–≤–µ—Ä (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
–ó–∞–ø—É—Å–∫ REST API —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –æ—Å–Ω–æ–≤–Ω—ã–º Backend.
```bash
python api_server.py
```
–°–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: `http://localhost:8000`

### CLI –†–µ–∂–∏–º
–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —á–∞—Ç –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ.
```bash
python main.py
```

## API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ API –¥–æ—Å—Ç—É–ø–Ω–æ –≤ [API_USAGE.md](API_USAGE.md).

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
ML/
‚îú‚îÄ‚îÄ api_server.py        # FastAPI —Å–µ—Ä–≤–µ—Ä
‚îú‚îÄ‚îÄ config.yaml          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ main.py              # CLI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ models/              # –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –º–æ–¥–µ–ª–µ–π (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îú‚îÄ‚îÄ src/                 # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
‚îÇ   ‚îú‚îÄ‚îÄ config_manager.py
‚îÇ   ‚îú‚îÄ‚îÄ input_handler.py
‚îÇ   ‚îú‚îÄ‚îÄ logger.py
‚îÇ   ‚îú‚îÄ‚îÄ model_downloader.py
‚îÇ   ‚îú‚îÄ‚îÄ model_manager.py
‚îÇ   ‚îî‚îÄ‚îÄ signal_handler.py
‚îî‚îÄ‚îÄ requirements.txt     # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏